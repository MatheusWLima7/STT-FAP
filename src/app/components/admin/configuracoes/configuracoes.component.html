<div class="configuracoes">
  <div class="page-header">
    <h1>Configura√ß√µes do Sistema</h1>
    <div class="header-actions">
      <button class="btn-secondary" (click)="voltar()">
        ‚Üê Voltar
      </button>
    </div>
  </div>

  <!-- Mensagens -->
  <div *ngIf="error" class="alert alert-error">
    {{ error }}
  </div>

  <div *ngIf="success" class="alert alert-success">
    {{ success }}
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-overlay">
    <div class="spinner"></div>
    <p>Processando...</p>
  </div>

  <div class="configuracoes-container">
    
    <!-- Abas -->
    <div class="tabs-container">
      <button class="tab-button" 
              [class.active]="abaSelecionada === 'geral'"
              (click)="selecionarAba('geral')">
        üè¢ Geral
      </button>
      <button class="tab-button" 
              [class.active]="abaSelecionada === 'inspecoes'"
              (click)="selecionarAba('inspecoes')">
        üîç Inspe√ß√µes
      </button>
      <button class="tab-button" 
              [class.active]="abaSelecionada === 'notificacoes'"
              (click)="selecionarAba('notificacoes')">
        üìß Notifica√ß√µes
      </button>
      <button class="tab-button" 
              [class.active]="abaSelecionada === 'relatorios'"
              (click)="selecionarAba('relatorios')">
        üìä Relat√≥rios
      </button>
      <button class="tab-button" 
              [class.active]="abaSelecionada === 'backup'"
              (click)="selecionarAba('backup')">
        üíæ Backup
      </button>
    </div>

    <!-- Formul√°rio -->
    <form [formGroup]="configForm" (ngSubmit)="onSubmit()" class="config-form">
      
      <!-- Aba Geral -->
      <div *ngIf="abaSelecionada === 'geral'" class="tab-content">
        <h3>Informa√ß√µes da Empresa</h3>
        <div class="form-grid">
          
          <div class="form-group">
            <label for="nomeEmpresa">Nome da Empresa *</label>
            <input type="text" 
                   id="nomeEmpresa" 
                   formControlName="nomeEmpresa"
                   [class.invalid]="isFieldInvalid('nomeEmpresa')"
                   placeholder="Nome da empresa">
            <div *ngIf="isFieldInvalid('nomeEmpresa')" class="field-error">
              {{ getFieldError('nomeEmpresa') }}
            </div>
          </div>

          <div class="form-group">
            <label for="cnpj">CNPJ *</label>
            <input type="text" 
                   id="cnpj" 
                   formControlName="cnpj"
                   [class.invalid]="isFieldInvalid('cnpj')"
                   placeholder="00.000.000/0000-00"
                   maxlength="18"
                   (input)="formatarCNPJ($event)">
            <div *ngIf="isFieldInvalid('cnpj')" class="field-error">
              {{ getFieldError('cnpj') }}
            </div>
          </div>

          <div class="form-group full-width">
            <label for="endereco">Endere√ßo *</label>
            <input type="text" 
                   id="endereco" 
                   formControlName="endereco"
                   [class.invalid]="isFieldInvalid('endereco')"
                   placeholder="Endere√ßo completo">
            <div *ngIf="isFieldInvalid('endereco')" class="field-error">
              {{ getFieldError('endereco') }}
            </div>
          </div>

          <div class="form-group">
            <label for="telefone">Telefone *</label>
            <input type="text" 
                   id="telefone" 
                   formControlName="telefone"
                   [class.invalid]="isFieldInvalid('telefone')"
                   placeholder="(11) 99999-9999"
                   maxlength="15"
                   (input)="formatarTelefone($event)">
            <div *ngIf="isFieldInvalid('telefone')" class="field-error">
              {{ getFieldError('telefone') }}
            </div>
          </div>

          <div class="form-group">
            <label for="email">E-mail *</label>
            <input type="email" 
                   id="email" 
                   formControlName="email"
                   [class.invalid]="isFieldInvalid('email')"
                   placeholder="contato@empresa.com">
            <div *ngIf="isFieldInvalid('email')" class="field-error">
              {{ getFieldError('email') }}
            </div>
          </div>

        </div>
      </div>

      <!-- Aba Inspe√ß√µes -->
      <div *ngIf="abaSelecionada === 'inspecoes'" class="tab-content">
        <h3>Configura√ß√µes de Inspe√ß√£o</h3>
        <div class="form-grid">
          
          <div class="form-group">
            <label for="diasAntecedenciaInspecao">Dias de Anteced√™ncia para Notificar *</label>
            <input type="number" 
                   id="diasAntecedenciaInspecao" 
                   formControlName="diasAntecedenciaInspecao"
                   [class.invalid]="isFieldInvalid('diasAntecedenciaInspecao')"
                   min="1" max="365">
            <small>Quantos dias antes da inspe√ß√£o notificar</small>
            <div *ngIf="isFieldInvalid('diasAntecedenciaInspecao')" class="field-error">
              {{ getFieldError('diasAntecedenciaInspecao') }}
            </div>
          </div>

          <div class="form-group">
            <label for="diasToleranciaAtraso">Dias de Toler√¢ncia para Atraso *</label>
            <input type="number" 
                   id="diasToleranciaAtraso" 
                   formControlName="diasToleranciaAtraso"
                   [class.invalid]="isFieldInvalid('diasToleranciaAtraso')"
                   min="0" max="30">
            <small>Quantos dias ap√≥s o vencimento considerar atrasado</small>
            <div *ngIf="isFieldInvalid('diasToleranciaAtraso')" class="field-error">
              {{ getFieldError('diasToleranciaAtraso') }}
            </div>
          </div>

          <div class="form-group">
            <label for="validadeInspecaoMeses">Validade da Inspe√ß√£o (meses) *</label>
            <input type="number" 
                   id="validadeInspecaoMeses" 
                   formControlName="validadeInspecaoMeses"
                   [class.invalid]="isFieldInvalid('validadeInspecaoMeses')"
                   min="1" max="60">
            <small>Per√≠odo de validade de uma inspe√ß√£o</small>
            <div *ngIf="isFieldInvalid('validadeInspecaoMeses')" class="field-error">
              {{ getFieldError('validadeInspecaoMeses') }}
            </div>
          </div>

        </div>
      </div>

      <!-- Aba Notifica√ß√µes -->
      <div *ngIf="abaSelecionada === 'notificacoes'" class="tab-content">
        <h3>Configura√ß√µes de Notifica√ß√£o</h3>
        
        <div class="checkbox-section">
          <h4>Canais de Notifica√ß√£o</h4>
          <div class="checkbox-group">
            <label class="checkbox-item">
              <input type="checkbox" formControlName="emailNotificacoes">
              <span>üìß Notifica√ß√µes por E-mail</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" formControlName="smsNotificacoes">
              <span>üì± Notifica√ß√µes por SMS</span>
            </label>
          </div>
        </div>

        <div class="checkbox-section">
          <h4>Tipos de Notifica√ß√£o</h4>
          <div class="checkbox-group">
            <label class="checkbox-item">
              <input type="checkbox" formControlName="notificarVencimento">
              <span>‚è∞ Vencimentos de Extintores</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" formControlName="notificarInspecoesPendentes">
              <span>üîç Inspe√ß√µes Pendentes</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" formControlName="notificarServicosAtrasados">
              <span>‚ö†Ô∏è Servi√ßos Atrasados</span>
            </label>
          </div>
        </div>

        <div class="test-section">
          <button type="button" class="btn-test" (click)="testarNotificacoes()">
            üß™ Testar Notifica√ß√µes
          </button>
          <small>Enviar notifica√ß√µes de teste para verificar configura√ß√£o</small>
        </div>
      </div>

      <!-- Aba Relat√≥rios -->
      <div *ngIf="abaSelecionada === 'relatorios'" class="tab-content">
        <h3>Configura√ß√µes de Relat√≥rios</h3>
        <div class="form-grid">
          
          <div class="form-group">
            <label for="logoEmpresa">Logo da Empresa</label>
            <input type="file" 
                   #logoInput
                   accept="image/*"
                   (change)="onLogoSelected($event)"
                   style="display: none">
            <button type="button" 
                    class="btn-upload" 
                    (click)="logoInput.click()">
              üì∑ Selecionar Logo
            </button>
            <small *ngIf="configForm.get('logoEmpresa')?.value">
              Arquivo: {{ configForm.get('logoEmpresa')?.value }}
            </small>
            <small>M√°ximo 2MB - JPG, PNG ou GIF</small>
          </div>

          <div class="form-group">
            <label for="formatoPadraoRelatorio">Formato Padr√£o *</label>
            <select id="formatoPadraoRelatorio" 
                    formControlName="formatoPadraoRelatorio"
                    [class.invalid]="isFieldInvalid('formatoPadraoRelatorio')">
              <option value="PDF">PDF</option>
              <option value="EXCEL">Excel</option>
              <option value="FIESC">FIESC</option>
            </select>
            <div *ngIf="isFieldInvalid('formatoPadraoRelatorio')" class="field-error">
              {{ getFieldError('formatoPadraoRelatorio') }}
            </div>
          </div>

          <div class="form-group full-width">
            <div class="checkbox-group">
              <label class="checkbox-item">
                <input type="checkbox" formControlName="incluirAssinaturasPadrao">
                <span>‚úçÔ∏è Incluir Assinaturas por Padr√£o</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" formControlName="incluirFotosPadrao">
                <span>üì∏ Incluir Fotos por Padr√£o</span>
              </label>
            </div>
          </div>

        </div>
      </div>

      <!-- Aba Backup -->
      <div *ngIf="abaSelecionada === 'backup'" class="tab-content">
        <h3>Configura√ß√µes de Backup</h3>
        <div class="form-grid">
          
          <div class="form-group">
            <div class="checkbox-group">
              <label class="checkbox-item">
                <input type="checkbox" formControlName="backupAutomatico">
                <span>ü§ñ Backup Autom√°tico</span>
              </label>
            </div>
          </div>

          <div class="form-group">
            <label for="frequenciaBackup">Frequ√™ncia do Backup *</label>
            <select id="frequenciaBackup" 
                    formControlName="frequenciaBackup"
                    [class.invalid]="isFieldInvalid('frequenciaBackup')">
              <option value="DIARIO">Di√°rio</option>
              <option value="SEMANAL">Semanal</option>
              <option value="MENSAL">Mensal</option>
            </select>
            <div *ngIf="isFieldInvalid('frequenciaBackup')" class="field-error">
              {{ getFieldError('frequenciaBackup') }}
            </div>
          </div>

          <div class="form-group">
            <label for="manterBackupsDias">Manter Backups por (dias) *</label>
            <input type="number" 
                   id="manterBackupsDias" 
                   formControlName="manterBackupsDias"
                   [class.invalid]="isFieldInvalid('manterBackupsDias')"
                   min="7" max="365">
            <small>Quantos dias manter os backups antes de excluir</small>
            <div *ngIf="isFieldInvalid('manterBackupsDias')" class="field-error">
              {{ getFieldError('manterBackupsDias') }}
            </div>
          </div>

        </div>

        <div class="backup-section">
          <button type="button" class="btn-backup" (click)="executarBackup()">
            üíæ Executar Backup Agora
          </button>
          <small>Executar backup manual imediatamente</small>
        </div>
      </div>

      <!-- A√ß√µes do Formul√°rio -->
      <div class="form-actions">
        <div class="actions-left">
        </div>
        
        <div class="actions-right">
          <button type="button" 
                  class="btn-secondary" 
                  (click)="voltar()">
            Cancelar
          </button>
          <button type="submit" 
                  class="btn-primary"
                  [disabled]="configForm.invalid || loading">
            üíæ Salvar Configura√ß√µes
          </button>
        </div>
      </div>

    </form>

  </div>
</div>