<div class="cadastro-usuario">
  <div class="page-header">
    <h1>{{ isEditMode ? 'Editar Usu√°rio' : 'Novo Usu√°rio' }}</h1>
    <div class="header-actions">
      <button class="btn-secondary" (click)="cancelar()">
        ‚Üê Voltar
      </button>
    </div>
  </div>

  <!-- Mensagens -->
  <div *ngIf="error" class="alert alert-error">
    {{ error }}
  </div>

  <div *ngIf="success" class="alert alert-success">
    {{ success }}
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-overlay">
    <div class="spinner"></div>
    <p>{{ isEditMode ? 'Carregando dados...' : 'Salvando usu√°rio...' }}</p>
  </div>

  <!-- Formul√°rio -->
  <form [formGroup]="userForm" (ngSubmit)="onSubmit()" class="user-form">
    
    <!-- Foto do Usu√°rio -->
    <div class="form-section">
      <h3>Foto do Usu√°rio</h3>
      <div class="photo-upload">
        <div class="photo-preview">
          <img *ngIf="previewFoto" [src]="previewFoto" alt="Preview da foto">
          <div *ngIf="!previewFoto" class="no-photo">
            <span>üì∑</span>
            <p>Nenhuma foto selecionada</p>
          </div>
        </div>
        <div class="photo-actions">
          <input type="file" 
                 #fileInput 
                 accept="image/*" 
                 (change)="onFileSelected($event)"
                 style="display: none">
          <button type="button" 
                  class="btn-upload" 
                  (click)="fileInput.click()">
            Selecionar Foto
          </button>
          <small>M√°ximo 2MB - JPG, PNG ou GIF</small>
        </div>
      </div>
    </div>

    <!-- Dados Pessoais -->
    <div class="form-section">
      <h3>Dados Pessoais</h3>
      <div class="form-grid">
        
        <div class="form-group">
          <label for="nome">Nome Completo *</label>
          <input type="text" 
                 id="nome" 
                 formControlName="nome"
                 [class.invalid]="isFieldInvalid('nome')"
                 placeholder="Digite o nome completo">
          <div *ngIf="isFieldInvalid('nome')" class="field-error">
            {{ getFieldError('nome') }}
          </div>
        </div>

        <div class="form-group">
          <label for="email">E-mail *</label>
          <input type="email" 
                 id="email" 
                 formControlName="email"
                 [class.invalid]="isFieldInvalid('email')"
                 placeholder="usuario@empresa.com">
          <div *ngIf="isFieldInvalid('email')" class="field-error">
            {{ getFieldError('email') }}
          </div>
        </div>

        <div class="form-group">
          <label for="cpf">CPF *</label>
          <input type="text" 
                 id="cpf" 
                 formControlName="cpf"
                 [class.invalid]="isFieldInvalid('cpf')"
                 placeholder="000.000.000-00"
                 maxlength="14"
                 (input)="formatarCPF($event)">
          <div *ngIf="isFieldInvalid('cpf')" class="field-error">
            {{ getFieldError('cpf') }}
          </div>
        </div>

        <div class="form-group">
          <label for="telefone">Telefone *</label>
          <input type="text" 
                 id="telefone" 
                 formControlName="telefone"
                 [class.invalid]="isFieldInvalid('telefone')"
                 placeholder="(11) 99999-9999"
                 maxlength="15"
                 (input)="formatarTelefone($event)">
          <div *ngIf="isFieldInvalid('telefone')" class="field-error">
            {{ getFieldError('telefone') }}
          </div>
        </div>

        <div class="form-group">
          <label for="cargo">Cargo/Fun√ß√£o</label>
          <input type="text" 
                 id="cargo" 
                 formControlName="cargo"
                 placeholder="Ex: T√©cnico em Seguran√ßa do Trabalho">
        </div>

        <div class="form-group">
          <label for="dataAdmissao">Data de Admiss√£o</label>
          <input type="date" 
                 id="dataAdmissao" 
                 formControlName="dataAdmissao">
        </div>

      </div>
    </div>

    <!-- Configura√ß√µes do Sistema -->
    <div class="form-section">
      <h3>Configura√ß√µes do Sistema</h3>
      <div class="form-grid">
        
        <div class="form-group">
          <label for="tipoUsuario">Tipo de Usu√°rio *</label>
          <select id="tipoUsuario" 
                  formControlName="tipoUsuario"
                  [class.invalid]="isFieldInvalid('tipoUsuario')">
            <option value="">Selecione o tipo</option>
            <option *ngFor="let tipo of tiposUsuario" [value]="tipo.value">
              {{ tipo.label }}
            </option>
          </select>
          <div *ngIf="isFieldInvalid('tipoUsuario')" class="field-error">
            {{ getFieldError('tipoUsuario') }}
          </div>
        </div>

        <div class="form-group" *ngIf="isEditMode">
          <label for="status">Status</label>
          <select id="status" formControlName="status">
            <option value="ATIVO">Ativo</option>
            <option value="INATIVO">Inativo</option>
            <option value="BLOQUEADO">Bloqueado</option>
          </select>
        </div>

        <div class="form-group full-width">
          <label for="unidadesVinculadas">Unidades Vinculadas *</label>
          <select id="unidadesVinculadas" 
                  formControlName="unidadesVinculadas"
                  multiple
                  [class.invalid]="isFieldInvalid('unidadesVinculadas')">
            <option *ngFor="let unidade of unidadesDisponiveis" [value]="unidade.id">
              {{ unidade.nome }}
            </option>
          </select>
          <small>Mantenha Ctrl pressionado para selecionar m√∫ltiplas unidades</small>
          <div *ngIf="isFieldInvalid('unidadesVinculadas')" class="field-error">
            Selecione pelo menos uma unidade
          </div>
        </div>

      </div>
    </div>

    <!-- Observa√ß√µes -->
    <div class="form-section">
      <h3>Observa√ß√µes</h3>
      <div class="form-group">
        <label for="observacoes">Observa√ß√µes Adicionais</label>
        <textarea id="observacoes" 
                  formControlName="observacoes"
                  rows="4"
                  placeholder="Informa√ß√µes adicionais sobre o usu√°rio..."
                  maxlength="500"></textarea>
        <small>{{ userForm.get('observacoes')?.value?.length || 0 }}/500 caracteres</small>
      </div>
    </div>

    <!-- A√ß√µes do Formul√°rio -->
    <div class="form-actions">
      <div class="actions-left">
        <button *ngIf="isEditMode" 
                type="button" 
                class="btn-warning"
                (click)="resetarSenha()">
          üîë Resetar Senha
        </button>
      </div>
      
      <div class="actions-right">
        <button type="button" 
                class="btn-secondary" 
                (click)="cancelar()">
          Cancelar
        </button>
        <button type="submit" 
                class="btn-primary"
                [disabled]="userForm.invalid || loading">
          {{ isEditMode ? 'Atualizar' : 'Criar' }} Usu√°rio
        </button>
      </div>
    </div>

  </form>

  <!-- Informa√ß√µes Adicionais -->
  <div *ngIf="!isEditMode" class="info-box">
    <h4>‚ÑπÔ∏è Informa√ß√µes Importantes</h4>
    <ul>
      <li>Uma senha tempor√°ria ser√° gerada automaticamente</li>
      <li>O usu√°rio receber√° um email com as credenciais de acesso</li>
      <li>A senha deve ser alterada no primeiro login</li>
      <li>T√©cnicos s√≥ podem acessar as unidades vinculadas</li>
    </ul>
  </div>

</div>